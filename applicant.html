<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Halal Development Institute - Business Owner Application</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <!-- Page 1: Company Information -->
    <div id="page1" class="page">
        <div class="container">
            <div class="header">
                <div class="logo-section">
                    <h1>Halal Development Institute of the Philippines</h1>
                    <p class="subtitle">Business Owner Application</p>
                </div>
                <div class="user-info">
                    <span id="username-display">Business Owner</span>
                </div>
            </div>

            <div class="progress-indicator">
                <div class="step active" data-step="1">1</div>
                <div class="step" data-step="2">2</div>
                <div class="step" data-step="3">3</div>
                <div class="step" data-step="4">4</div>
            </div>

            <div class="form-section">
                <h2>I. Company Information</h2>
                <div class="form-group">
                    <label for="companyName">Name of Company *</label>
                    <input type="text" id="companyName" placeholder="Enter company name" required>
                </div>

                <div class="form-group">
                    <label for="companyAddress">Address *</label>
                    <input type="text" id="companyAddress" placeholder="Enter company address" required>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="permitLicense">Permit License No. (DTI or SEC) *</label>
                        <input type="text" id="permitLicense" placeholder="License number" required>
                    </div>
                    <div class="form-group">
                        <label for="dateIssued">Date Issued *</label>
                        <input type="date" id="dateIssued" required>
                    </div>
                    <div class="form-group">
                        <label for="validUntil">Valid Until *</label>
                        <input type="date" id="validUntil" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="telephone">Telephone *</label>
                        <input type="tel" id="telephone" placeholder="Phone number" required>
                    </div>
                    <div class="form-group">
                        <label for="email">E-mail *</label>
                        <input type="email" id="email" placeholder="Email address" required>
                    </div>
                </div>

                <div class="form-actions">
                    <button class="btn btn-primary" id="page1Next">Next</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Page 2: Items to be Applied -->
    <div id="page2" class="page hidden">
        <div class="container">
            <div class="header">
                <div class="logo-section">
                    <h1>Halal Development Institute of the Philippines</h1>
                    <p class="subtitle">Business Owner Application</p>
                </div>
            </div>

            <div class="progress-indicator">
                <div class="step" data-step="1">1</div>
                <div class="step active" data-step="2">2</div>
                <div class="step" data-step="3">3</div>
                <div class="step" data-step="4">4</div>
            </div>

            <div class="form-section">
                <h2>II. Items to be Applied</h2>
                <div class="items-list" id="itemsList"></div>
                <button class="btn btn-secondary" id="addItemBtn">+ Add Item</button>

                <h3>IIA. Product Manufacturing</h3>
                <div class="form-group">
                    <label>Is the product locally manufactured? *</label>
                    <div class="radio-group">
                        <label><input type="radio" name="manufacturing" value="local" required> Yes - Locally Manufactured</label>
                        <label><input type="radio" name="manufacturing" value="imported" required> No - Imported</label>
                        <label><input type="radio" name="manufacturing" value="both" required> Both</label>
                    </div>
                </div>

                <div id="localSection" class="manufacturing-section hidden">
                    <div class="form-group">
                        <label for="numPlants">Number of Plants *</label>
                        <input type="number" id="numPlants" min="1" placeholder="Enter number of plants">
                    </div>
                    <div class="form-group">
                        <label>Plant Addresses *</label>
                        <div id="plantAddressesContainer"></div>
                        <p class="note">Each text box represents one plant site address.</p>
                    </div>
                </div>

                <div id="importedSection" class="manufacturing-section hidden">
                    <div class="form-group">
                        <label for="countryOrigin">Country of Origin *</label>
                        <select id="countryOrigin">
                            <option value="">Select country</option>
                        </select>
                    </div>
                </div>

                <div id="bothSection" class="manufacturing-section hidden">
                    <div class="form-group">
                        <label for="numPlantsB">Number of Plants *</label>
                        <input type="number" id="numPlantsB" min="1" placeholder="Enter number of plants">
                    </div>
                    <div class="form-group">
                        <label>Plant Addresses *</label>
                        <div id="plantAddressesBContainer"></div>
                        <p class="note">Each text box represents one plant site address.</p>
                    </div>
                    <div class="form-group">
                        <label for="countryOriginB">Country of Origin *</label>
                        <select id="countryOriginB">
                            <option value="">Select country</option>
                        </select>
                    </div>
                </div>

                <div class="form-actions">
                    <button class="btn btn-secondary" id="page2Back">Back</button>
                    <button class="btn btn-primary" id="page2Next">Next</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Page 3: Required Documents -->
    <div id="page3" class="page hidden">
        <div class="container">
            <div class="header">
                <div class="logo-section">
                    <h1>Halal Development Institute of the Philippines</h1>
                    <p class="subtitle">Business Owner Application</p>
                </div>
            </div>

            <div class="progress-indicator">
                <div class="step" data-step="1">1</div>
                <div class="step" data-step="2">2</div>
                <div class="step active" data-step="3">3</div>
                <div class="step" data-step="4">4</div>
            </div>

            <div class="form-section">
                <h2>III. Required Documents</h2>
                <p class="note">All Documents must be submitted in PDF format.</p>
                <div class="documents-list" id="documentsList"></div>

                <div class="form-actions">
                    <button class="btn btn-secondary" id="page3Back">Back</button>
                    <button class="btn btn-primary" id="page3Next">Next</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Page 4: Confirmation and Agreement -->
    <div id="page4" class="page hidden">
        <div class="container">
            <div class="header">
                <div class="logo-section">
                    <h1>Halal Development Institute of the Philippines</h1>
                    <p class="subtitle">Business Owner Application</p>
                </div>
            </div>

            <div class="progress-indicator">
                <div class="step" data-step="1">1</div>
                <div class="step" data-step="2">2</div>
                <div class="step" data-step="3">3</div>
                <div class="step active" data-step="4">4</div>
            </div>

            <div class="form-section">
                <h2>IV. Confirm and Agreement</h2>
                <div class="form-group">
                    <label for="firstName">First Name *</label>
                    <input type="text" id="firstName" placeholder="Enter first name" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="middleName">Middle Name</label>
                        <input type="text" id="middleName" placeholder="Enter middle name">
                    </div>
                    <div class="form-group">
                        <label for="lastName">Last Name *</label>
                        <input type="text" id="lastName" placeholder="Enter last name" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="position">Position *</label>
                    <select id="position" required>
                        <option value="">Select position</option>
                        <option value="CEO">Chief Executive Officer (CEO)</option>
                        <option value="COO">Chief Operating Officer (COO)</option>
                        <option value="CFO">Chief Financial Officer (CFO)</option>
                        <option value="CMO">Chief Marketing Officer (CMO)</option>
                        <option value="CPO">Chief Product Officer (CPO)</option>
                        <option value="General Manager">General Manager</option>
                        <option value="Owner">Owner / Proprietor</option>
                        <option value="Other">Other</option>
                    </select>
                </div>

                <div class="certification-statement">
                    <input type="checkbox" id="certifyCheckbox">
                    <label for="certifyCheckbox">I HEREBY CERTIFY THAT THE ANSWERS AND DOCUMENTS ARE TRUE AND CORRECT.</label>
                </div>

                <div class="form-actions">
                    <button class="btn btn-secondary" id="page4Back">Back</button>
                    <button class="btn btn-primary" id="page4Submit">Submit</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Page 5: Success Modal -->
    <div id="page5" class="modal hidden">
        <div class="modal-content">
            <div class="success-message">
                <div class="success-icon">‚úì</div>
                <h2>Application Submitted Successfully!</h2>
                <p>Your application has been successfully submitted to the halal certifying body for evaluation.</p>
                <button class="btn btn-primary" id="page5Ok">OK</button>
            </div>
        </div>
    </div>

    <!-- Page 6: Applicant Dashboard -->
    <div id="page6" class="page hidden">
        <div class="sidebar">
            <div class="user-profile">
                <div class="avatar">üë©</div>
                <div class="user-details">
                    <h3 id="applicantName"></h3>
                    <p>Business Owner</p>
                </div>
            </div>
            <nav class="sidebar-nav" id="applicantSidebarNav">
                <a href="#" class="nav-item active" data-page="6">üìä Dashboard</a>
                <a href="#" class="nav-item" data-page="7" id="navNewApplication" style="display: none;">üìù New Application</a>
                <a href="#" class="nav-item" data-page="8" id="navApplicationProgress" style="display: none;">üìà Application Progress</a>
                <a href="#" class="nav-item" data-page="10">‚öôÔ∏è Settings</a>
            </nav>
            <button class="logout-btn" onclick="logout()">
                <span>üö™</span> Logout
            </button>
        </div>

        <div class="main-content">
            <div class="header">
                <h1>Halal Development Institute of the Philippines</h1>
            </div>

            <div class="section" id="dashboardNoApplication" style="display: none;">
                <div style="text-align: center; padding: 60px 20px;">
                    <div style="font-size: 64px; margin-bottom: 20px;">üìã</div>
                    <h2 style="margin-bottom: 15px; color: var(--text-primary);">No Application Yet</h2>
                    <p style="color: var(--text-secondary); margin-bottom: 30px; font-size: 16px;">Start your halal certification application process by clicking the button below.</p>
                    <button class="btn btn-primary" onclick="startNewApplication()" style="display: inline-flex; align-items: center; gap: 8px; padding: 12px 24px; font-size: 16px;">
                        <span>‚ûï</span> Start New Application
                    </button>
                </div>
            </div>

            <div id="dashboardWithApplication" style="display: none;">
                <div class="section">
                    <div class="section-header">
                        <h2>Notifications</h2>
                        <button class="btn btn-secondary" id="markAllNotifications">Mark all read</button>
                    </div>
                    <div id="applicantNotifications"></div>
                </div>

                <div class="section">
                    <h2>Business Information</h2>
                    <div class="info-grid" id="dashboardBusinessInfo">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>

                <div class="section">
                    <h2>Application Progress</h2>
                    <div class="progress-bar-container" style="margin: 20px 0;">
                        <div class="progress-bar-label" style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span>Overall Compliance</span>
                            <span id="dashboardProgressPercentage">0%</span>
                        </div>
                        <div class="progress-bar" style="width: 100%; height: 30px; background: var(--background); border-radius: var(--radius); overflow: hidden;">
                            <div id="dashboardProgressBarFill" style="height: 100%; background: var(--primary); width: 0%; transition: width 0.3s ease;"></div>
                        </div>
                    </div>
                    <div style="margin-top: 20px;">
                        <button class="btn btn-primary" onclick="viewApplicationProgress()">View Full Progress Details</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Page 8: Application Progress Dashboard -->
    <div id="page8" class="page hidden">
        <div class="sidebar">
            <div class="user-profile">
                <div class="avatar">üë©</div>
                <div class="user-details">
                    <h3 id="applicantName2"></h3>
                    <p>Business Owner</p>
                </div>
            </div>
            <nav class="sidebar-nav" id="applicantSidebarNav2">
                <a href="#" class="nav-item" data-page="6">üìä Dashboard</a>
                <a href="#" class="nav-item" data-page="7" id="navNewApplication2" style="display: none;">üìù New Application</a>
                <a href="#" class="nav-item active" data-page="8" id="navApplicationProgress2" style="display: none;">üìà Application Progress</a>
                <a href="#" class="nav-item" data-page="10">‚öôÔ∏è Settings</a>
            </nav>
            <button class="logout-btn" onclick="logout()">
                <span>üö™</span> Logout
            </button>
        </div>

        <div class="main-content">
            <div class="header">
                <h1>Halal Development Institute of the Philippines</h1>
            </div>
            <div class="form-section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 style="margin: 0;">Application Progress</h2>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-secondary" id="editApplicationBtn">‚úèÔ∏è Edit Application</button>
                        <button class="btn btn-danger" id="deleteApplicationBtn">üóëÔ∏è Delete Application</button>
                    </div>
                </div>
                
                <div class="progress-details">
                    <div class="info-grid">
                        <div class="info-item">
                            <label>Company</label>
                            <p id="progCompany">Yarab Cafe</p>
                        </div>
                        <div class="info-item">
                            <label>Contact Person</label>
                            <p id="progContact">Business Owner</p>
                        </div>
                        <div class="info-item">
                            <label>Address</label>
                            <p id="progAddress">Toril, Davao City</p>
                        </div>
                        <div class="info-item">
                            <label>Contact No.</label>
                            <p id="progPhone">09054541332</p>
                        </div>
                        <div class="info-item">
                            <label>Date Submitted</label>
                            <p id="progDate">2-25-2025</p>
                        </div>
                        <div class="info-item">
                            <label>Evaluator</label>
                            <p id="progEvaluator">Dr. Rahim S. Udzaman</p>
                        </div>
                    </div>
                </div>

                <!-- Progress Bar -->
                <div class="progress-bar-container" style="margin: 20px 0;">
                    <div class="progress-bar-label" style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span>Overall Compliance</span>
                        <span id="progressPercentage">0%</span>
                    </div>
                    <div class="progress-bar" style="width: 100%; height: 30px; background: var(--background); border-radius: var(--radius); overflow: hidden;">
                        <div id="progressBarFill" style="height: 100%; background: var(--primary); width: 0%; transition: width 0.3s ease;"></div>
                    </div>
                </div>

                <div class="documents-progress" id="documentsProgress"></div>

                <div class="form-group" style="margin-top: 30px;">
                    <label for="certifierNotesDisplay">Certifier Notes & Findings</label>
                    <div id="certifierNotesDisplay" style="padding: 15px; background: var(--background); border-radius: var(--radius); min-height: 100px; border: 1px solid var(--border);">
                        <p style="color: var(--text-secondary); font-style: italic;">No notes available yet.</p>
                    </div>
                </div>

                <div class="form-actions" style="margin-top: 30px; justify-content: center;">
                    <button class="btn btn-primary" id="applyNewApplicationBtn" style="display: none;">Apply for New Application</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                window.location.href = 'welcome.html';
            }
        }
        
        function startNewApplication() {
            // Reset form state
            if (typeof applicantState !== 'undefined') {
                applicantState.applicationData = {
                    company: {},
                    items: [],
                    documents: {},
                    applicant: {},
                    manufacturing: null
                };
                applicantState.uploadedFiles = {};
                
                // Initialize documents
                if (typeof appState !== 'undefined' && appState.documents) {
                    appState.documents.forEach(doc => {
                        applicantState.applicationData.documents[doc] = { status: 'incomplete', file: null };
                    });
                }
            }
            
            // Reset form
            $('#companyName, #companyAddress, #permitLicense, #dateIssued, #validUntil, #telephone, #email').val('');
            $('#itemsList').empty();
            if (typeof addItemRow === 'function') {
                addItemRow();
            }
            $('input[name="manufacturing"]').prop('checked', false);
            $('#numPlants, #numPlantsB').val('');
            $('#plantAddressesContainer, #plantAddressesBContainer').empty();
            $('#localSection, #importedSection, #bothSection').addClass('hidden');
            $('#firstName, #middleName, #lastName, #position').val('');
            $('#certifyCheckbox').prop('checked', false);
            
            // Go to first page
            if (typeof showPage === 'function') {
                showPage(1);
            }
            
            // Update progress indicator
            $('.step').removeClass('active');
            $('.step[data-step="1"]').addClass('active');
        }
        
        // Make function globally available
        window.startNewApplication = startNewApplication;

        function loadApplicantNameFromSession() {
            try {
                var raw = localStorage.getItem('auth_session');
                if (!raw) return;
                var session = JSON.parse(raw);
                if (!session || session.role !== 'applicant' || !session.user) return;
                var name = 'Business Owner';

                var elHeader = document.getElementById('username-display');
                if (elHeader) {
					elHeader.textContent = name;
                }

                var elDash1 = document.getElementById('applicantName');
                if (elDash1) {
					elDash1.textContent = '';
                }

                var elDash2 = document.getElementById('applicantName2');
                if (elDash2) {
					elDash2.textContent = '';
                }

                var elContact = document.getElementById('progContact');
                if (elContact) {
                    elContact.textContent = 'Business Owner';
                }
            } catch (e) {}
        }

        function setupNotificationDeletion() {
            try {
                var btn = document.getElementById('markAllNotifications');
                if (!btn) return;

                btn.addEventListener('click', function () {
                    // Clear applicant notifications from localStorage
                    try {
                        localStorage.removeItem('applicantNotifications');
                    } catch (e) {}

                    // Clear notifications from the dashboard container
                    var container = document.getElementById('applicantNotifications');
                    if (container) {
                        container.innerHTML = '';
                    }
                });
            } catch (e) {}
        }

        document.addEventListener('DOMContentLoaded', function () {
            loadApplicantNameFromSession();
            setupNotificationDeletion();
        });
    </script>
    <script src="shared.js"></script>
    <script src="applicant.js"></script>
</body>
</html>